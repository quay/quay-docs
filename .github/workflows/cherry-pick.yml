name: Cherry Pick PR

on:
  issue_comment:
    types: [created]

jobs:
  cherry_pick:
    if: ${{ startsWith(github.event.comment.body, '/cherry-pick') }}
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Extract target branch from comment
        id: extract_branch
        run: echo "TARGET_BRANCH=$(echo '${{ github.event.comment.body }}' | cut -d' ' -f2 | tr -d '?')" >> $GITHUB_ENV

      - name: Run Cherry-Pick Action
        uses: your-org/your-cherry-pick-action@v1
        with:
          target-branch: redhat-3.12
          pr-creator-token: ${{ secrets.GITHUB_TOKEN }}
          pr-title-suffix: '[Cherry-Pick]'
        id: cherry_pick_action

      - name: Output PR number
        run: echo "PR Number: ${{ steps.cherry_pick_action.outputs.pr-number }}"

      - name: Comment on PR with Result
        run: |
          gh pr comment ${{ github.event.issue.number }} --body "Cherry-pick to `redhat-3.12` was successful. PR Number: ${{ steps.cherry_pick_action.outputs.pr-number }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

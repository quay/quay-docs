name: Cherry Pick PR

on:
  issue_comment:
    types: [created]

jobs:
  cherry_pick:
    if: ${{ github.event.comment.body.startsWith('/cherry-pick') }}
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Extract target branch from comment
        id: extract_branch
        run: |
          TARGET_BRANCH=$(echo '${{ github.event.comment.body }}' | cut -d' ' -f2 | tr -d '?')
          echo "TARGET_BRANCH=$TARGET_BRANCH" >> $GITHUB_ENV

      - name: Cherry pick the commit
        uses: carloscastrojumo/github-cherry-pick-action@v1.0.1
        with:
          target-branch: ${{ env.TARGET_BRANCH }}
          pr-creator-token: ${{ secrets.GITHUB_TOKEN }}
          pr-title-suffix: '[Cherry-Pick]'
        id: cherry_pick_action

      - name: Output PR number
        run: echo "PR Number: ${{ steps.cherry_pick_action.outputs.pr-number }}"

      - name: Comment on PR with Result
        run: |
          gh pr comment ${{ github.event.issue.number }} --body "Cherry-pick to `${{ env.TARGET_BRANCH }}` was successful. PR Number: ${{ steps.cherry_pick_action.outputs.pr-number }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

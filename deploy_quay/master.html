<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.22">
<title>Proof of Concept - Deploying Red Hat Quay</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body id="deploy-quay-single" class="article">
<div id="header">
<h1>Proof of Concept - Deploying Red Hat Quay</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat Quay is an enterprise-quality registry for building, securing and serving container images. The documents in this section detail how to deploy Red Hat Quay for <em>proof of concept</em>, or non-production, purposes. The primary objectives of this document includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to deploy Red Hat Quay for basic non-production purposes.</p>
</li>
<li>
<p>Asses Red Hat Quay&#8217;s container image management, including how to push, pull, tag, and organize images.</p>
</li>
<li>
<p>Explore availability and scalability.</p>
</li>
<li>
<p>How to deploy an advanced Red Hat Quay proof of concept deployment using SSL/TLS certificates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Beyond the primary objectives of this document, a proof of concept deployment can be used to test various features offered by Red Hat Quay, such as establishing superusers, setting repository quota limitations, enabling Splunk for action log storage, enabling Clair for vulnerability reporting, and more. See the "Next steps" section for a list of some of the features available after you have followed this guide.</p>
</div>
<div class="paragraph">
<p>This proof of concept deployment procedure can be followed on a single machine, either physical or virtual.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="poc-prerequisites">Prerequisites</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Red Hat Enterprise Linux (RHEL) 9</p>
<div class="ulist">
<ul>
<li>
<p>To obtain the latest version of Red Hat Enterprise Linux (RHEL) 9, see <a href="https://access.redhat.com/downloads/content/479/ver=/rhel---9/9.0/x86_64/product-software">Downlad Red Hat Enterprise Linux</a>.</p>
</li>
<li>
<p>For installation instructions, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/">Product Documentation for Red Hat Enterprise Linux 8</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>An active subscription to Red Hat</p>
</li>
<li>
<p>Two or more virtual CPUs</p>
</li>
<li>
<p>4 GB or more of RAM</p>
</li>
<li>
<p>Approximately 30 GB of disk space on your test system, which can be broken down as follows:</p>
<div class="ulist">
<ul>
<li>
<p>Approximately 10 GB of disk space for the Red Hat Enterprise Linux (RHEL) operating system.</p>
</li>
<li>
<p>Approximately 10 GB of disk space for Docker storage for running three containers.</p>
</li>
<li>
<p>Approximately 10 GB of disk space for Red Hat Quay local storage.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>CEPH or other local storage might require more memory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>More information on sizing can be found at <a href="https://access.redhat.com/articles/5177961">Quay 3.x Sizing Guidlines</a>.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="poc-using-podman">Installing Podman</h3>
<div class="paragraph">
<p>This document uses Podman for creating and deploying containers.</p>
</div>
<div class="paragraph">
<p>For more information on Podman and related technologies, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/building_running_and_managing_containers/index">Building, running, and managing Linux containers on Red Hat Enterprise Linux 9</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not have Podman installed on your system, the use of equivalent Docker commands might be possible, however this is not recommended. Docker has not been tested with Red Hat Quay 3.11, and will be deprecated in a future release. Podman is recommended for highly available, production quality deployments of Red Hat Quay 3.11.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the following procedure to install Podman.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the following command to install Podman:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo yum install -y podman</code></pre>
</div>
</div>
</li>
<li>
<p>Alternatively, you can install the <code>container-tools</code> module, which pulls in the full set of container software packages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo yum module install -y container-tools</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="poc-configuring-rhel-server">Preparing Red Hat Enterprise Linux for a Red Hat Quay proof of concept deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the following procedures to configure Red Hat Enterprise Linux (RHEL) for a Red Hat Quay proof of concept deployment.</p>
</div>
<div class="sect2">
<h3 id="poc-install-register-rhel-server">Install and register the RHEL server</h3>
<div class="paragraph">
<p>Use the following procedure to configure the Red Hat Enterprise Linux (RHEL) server for a Red Hat Quay proof of concept deployment.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the latest RHEL 9 server. You can do a minimal, shell-access only install, or Server plus GUI if you want a desktop.</p>
</li>
<li>
<p>Register and subscribe your RHEL server system as described in <a href="https://access.redhat.com/solutions/253273">How to register and subscribe a RHEL system to the Red Hat Customer Portal using Red Hat Subscription-Manager</a></p>
</li>
<li>
<p>Enter the following commands to register your system and list available subscriptions. Choose an available RHEL server subscription, attach to its pool ID, and upgrade to the latest software:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal"># subscription-manager register --username=&lt;user_name&gt; --password=&lt;password&gt;
# subscription-manager refresh
# subscription-manager list --available
# subscription-manager attach --pool=&lt;pool_id&gt;
# yum update -y</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="poc-registry-authentication">Registry authentication</h3>
<div class="paragraph">
<p>Use the following procedure to authenticate your registry for a Red Hat Quay proof of concept.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set up authentication to <code>registry.redhat.io</code> by following the <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a> procedure. Setting up authentication allows you to pull the <code>Quay</code> container.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This differs from earlier versions of Red Hat Quay, when the images were hosted on Quay.io.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the following command to log in to the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman login registry.redhat.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are prompted to enter your <code>username</code> and <code>password</code>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="poc-firewall-configuration">Firewall configuration</h3>
<div class="paragraph">
<p>If you have a firewall running on your system, you might have to add rules that allow access to Red Hat Quay. Use the following procedure to configure your firewall for a proof of concept deployment.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>The commands required depend on the ports that you have mapped on your system, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal"># firewall-cmd --permanent --add-port=80/tcp \
&amp;&amp; firewall-cmd --permanent --add-port=443/tcp \
&amp;&amp; firewall-cmd --permanent --add-port=5432/tcp \
&amp;&amp; firewall-cmd --permanent --add-port=5433/tcp \
&amp;&amp; firewall-cmd --permanent --add-port=6379/tcp \
&amp;&amp; firewall-cmd --reload</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="poc-ip-naming">IP addressing and naming services</h3>
<div class="paragraph">
<p>There are several ways to configure the component containers in Red Hat Quay so that they can communicate with each other, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Using the IP addresses for the containers</strong>. You can determine the IP address for containers with <code>podman inspect</code> and then use the values in the configuration tool when specifying the connection strings, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman inspect -f "{{.NetworkSettings.IPAddress}}" postgresql-quay</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach is susceptible to host restarts, as the IP addresses for the containers will change after a reboot.</p>
</div>
</li>
<li>
<p><strong>Using a naming service</strong>. If you want your deployment to survive container restarts, which typically result in changed IP addresses, you can implement a naming service. For example, the <a href="https://github.com/containers/dnsname">dnsname</a> plugin is used to allow containers to resolve each other by name.</p>
</li>
<li>
<p><strong>Using the host network</strong>. You can use the <code>podman run</code> command with the <code>--net=host</code> option and then use container ports on the host when specifying the addresses in the configuration. This option is susceptible to port conflicts when two containers want to use the same port. This method is not recommended.</p>
</li>
<li>
<p><strong>Configuring port mapping</strong>. You can use port mappings to expose ports on the host and then use these ports in combination with the host IP address or host name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This document uses port mapping and assumes a static IP address for your host system.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Sample proof of concept port mapping</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Port mapping</th>
<th class="tableblock halign-left valign-top">Address</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p 80:8080</code> <code>-p 443:8443</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://quay-server.example.com</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postgres for Quay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p 5432:5432</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quay-server.example.com:5432</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p 6379:6379</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quay-server.example.com:6379</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postgres for Clair V4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p 5433:5432</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quay-server.example.com:5433</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clair V4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p 8081:8080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://quay-server.example.com:8081</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-system-deploy-quay">Preparing your system to deploy Red Hat Quay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a proof of concept Red Hat Quay deployment, you must configure port mapping, a database, and Redis prior to deploying the registry. Use the following procedures to prepare your system to deploy Red Hat Quay.</p>
</div>
<div class="sect2">
<h3 id="configuring-port-mapping">Configuring port mapping for Red Hat Quay</h3>
<div class="paragraph">
<p>You can use port mappings to expose ports on the host and then use these ports in combination with the host IP address or host name to navigate to the configuration tool endpoint.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command to obtain your static IP address for your host system:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ ip a</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">---
    link/ether 6c:6a:77:eb:09:f1 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.132/24 brd 192.168.1.255 scope global dynamic noprefixroute wlp82s0
---</code></pre>
</div>
</div>
</li>
<li>
<p>Add the IP address and a local hostname, for example, <code>quay-server.example.com</code> to your <code>/etc/hosts</code> file that will be used to reach the configuration tool endpoint. You can confirm that the IP address and hostname have been added to the <code>/etc/hosts</code> file by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat /etc/hosts</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">192.168.1.138 quay-server.example.com</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="poc-configuring-database">Configuring the database</h3>
<div class="paragraph">
<p>Red Hat Quay requires a database for storing metadata. PostgreSQL is used throughout this document. For this deployment, a directory on the local file system to persist database data is used.</p>
</div>
<div class="paragraph">
<p>Use the following procedure to set up a PostgreSQL database.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the installation folder, denoted here by the <code>$QUAY</code> variable, create a directory for the database data by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ mkdir -p $QUAY/postgres-quay</code></pre>
</div>
</div>
</li>
<li>
<p>Set the appropriate permissions by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ setfacl -m u:26:-wx $QUAY/postgres-quay</code></pre>
</div>
</div>
</li>
<li>
<p>Start the <code>Postgres</code> container, specifying the username, password, and database name and port, with the volume definition for database data:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman run -d --rm --name postgresql-quay \
  -e POSTGRESQL_USER=quayuser \
  -e POSTGRESQL_PASSWORD=quaypass \
  -e POSTGRESQL_DATABASE=quay \
  -e POSTGRESQL_ADMIN_PASSWORD=adminpass \
  -p 5432:5432 \
  -v $QUAY/postgres-quay:/var/lib/pgsql/data:Z \
  registry.redhat.io/rhel8/postgresql-13:1-109</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the Postgres <code>pg_trgm</code> module is installed by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman exec -it postgresql-quay /bin/bash -c 'echo "CREATE EXTENSION IF NOT EXISTS pg_trgm" | psql -d quay -U postgres'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>pg_trgm</code> module is required for the <code>Quay</code> container.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="poc-configuring-redis">Configuring Redis</h3>
<div class="paragraph">
<p>Redis is a key-value store that is used by Red Hat Quay for live builder logs.</p>
</div>
<div class="paragraph">
<p>Use the following procedure to deploy the <code>Redis</code> container for the Red Hat Quay proof of concept.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Start the <code>Redis</code> container, specifying the port and password, by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman run -d --rm --name redis \
  -p 6379:6379 \
  -e REDIS_PASSWORD=strongpassword \
  registry.redhat.io/rhel8/redis-6:1-110</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="poc-configuring-quay">Deploying Red Hat Quay config tool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the following procedure to deploy the Red Hat Quay configuration tool. Afterwards, you can navigate to the registry endpoint and generate a configuration file that details all components, including registry settings, the database, and Redis connection parameters.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To generate a configuration file, enter the following command to run the <code>Quay</code> container in <code>config</code> mode. You must specify a password, for example, the string <code>secret</code>:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman run --rm -it --name quay_config -p 80:8080 -p 443:8443 registry.redhat.io/quay/quay-rhel8:v3.11.0 config secret</pre>
</div>
</div>
</li>
<li>
<p>Use your browser to access the user interface for the configuration tool at  <code>http://quay-server.example.com</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This documentation assumes that you have configured the <code>quay-server.example.com</code> hostname in your <code>/etc/hosts</code> file.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in with username and password specified</p>
</li>
<li>
<p>Log in with the username and password you set in Step 1 of <a href="#poc-configuring-quay">Configuring Red Hat Quay</a>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you followed this procedure, the username is <strong>quayconfig</strong> and the password is <strong>secret</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="poc-quay-setup">Red Hat Quay setup</h3>
<div class="paragraph">
<p>In the Red Hat Quay configuration editor, you must enter the following credentials:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic configuration</p>
</li>
<li>
<p>Server configuration</p>
</li>
<li>
<p>Database</p>
</li>
<li>
<p>Redis</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="poc-basic-configuration">Basic configuration</h4>
<div class="paragraph">
<p><strong>Basic configuration</strong> includes the <strong>Registry Title</strong>, <strong>Registry Title Short</strong>, <strong>Enterprise Logo URL</strong>, and <strong>Contact Information</strong> fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Procedure</div>
<div class="paragraph">
<p>The default values can be used if they are populated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For <strong>Registry Title</strong>, enter <strong>Project Quay</strong>.</p>
</li>
<li>
<p>For <strong>Registry Title Short</strong>, enter <strong>Project Quay</strong>.</p>
</li>
<li>
<p>Optional. Enter a URL for <strong>Enterprise Logo URL</strong>.</p>
</li>
<li>
<p>Optional. Enter contact information, choosing from one of the following options: <strong>URL</strong>, <strong>E-mail</strong>, <strong>IRC</strong>, <strong>Telephone</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="poc-server-configuration">Server configuration</h4>
<div class="paragraph">
<p><strong>Server configuration</strong> includes the <strong>Server Hostname</strong> and optional <strong>TLS</strong> fields.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>For this deployment, enter <code>quay-server.example.com</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="poc-database">Database</h4>
<div class="paragraph">
<p>In the <strong>Database</strong> section, specify the connection details for the database that Red Hat Quay uses to store metadata.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For <strong>Database Type,</strong> enter <code>Postgres</code>.</p>
</li>
<li>
<p>For <strong>Database Server,</strong> enter <code>quay-server.example.com:5432</code>.</p>
</li>
<li>
<p>For <strong>Username,</strong> enter <code>quayuser</code>.</p>
</li>
<li>
<p>For <strong>Password,</strong> enter <code>quaypass</code>.</p>
</li>
<li>
<p>For <strong>Database Name,</strong> enter <code>quay</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="poc-redis">Redis</h4>
<div class="paragraph">
<p>The Redis key-value store is used to store real-time events and build logs.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For <strong>Redis Hostname,</strong> enter <code>quay-server.example.com</code>.</p>
</li>
<li>
<p>For <strong>Redis port,</strong> enter <code>6379</code>. This is the default value.</p>
</li>
<li>
<p>For <strong>Redis password,</strong> enter <code>strongpassword</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="poc-validating">Validate and download configuration</h3>
<div class="paragraph">
<p>After all required fields have been set, validate your settings.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Click the <strong>Validate Configuration Changes</strong> button. If any errors are reported, continue editing your configuration until the settings are valid and Red Hat Quay can connect to your database and Redis servers.</p>
<div class="paragraph">
<p>After validation, download the <strong>Configuration</strong> file. Stop the <code>Quay</code> container that is running the configuration editor.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="poc-deploying-quay">Deploying Red Hat Quay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have configured your Red Hat Quay deployment, you can deploy it using the following procedures.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Red Hat Quay database is running.</p>
</li>
<li>
<p>The Redis server is running.</p>
</li>
<li>
<p>You have generated a valid configuration file.</p>
</li>
<li>
<p>You have stopped the <code>Quay</code> container that was running the configuration editor.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="preparing-configuration-folder">Preparing the configuration folder</h3>
<div class="paragraph">
<p>Use the following procedure to prepare your Red Hat Quay configuration folder.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a directory to copy the Red Hat Quay configuration bundle to:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ mkdir $QUAY/config</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the generated Red Hat Quay configuration bundle to the directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cp ~/Downloads/quay-config.tar.gz ~/config</code></pre>
</div>
</div>
</li>
<li>
<p>Change into the directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cd $QUAY/config</code></pre>
</div>
</div>
</li>
<li>
<p>Unpack the Red Hat Quay configuration bundle:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ tar xvf quay-config.tar.gz</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="preparing-local-storage">Prepare local storage for image data</h3>
<div class="paragraph">
<p>Use the following procedure to set your local file system to store registry images.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a local directory that will store registry images by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ mkdir $QUAY/storage</code></pre>
</div>
</div>
</li>
<li>
<p>Set the directory to store registry images:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ setfacl -m u:1001:-wx $QUAY/storage</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="deploy-quay-registry">Deploy the Red Hat Quay registry</h3>
<div class="paragraph">
<p>Use the following procedure to deploy the <code>Quay</code> registry container.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command to start the <code>Quay</code> registry container, specifying the appropriate volumes for configuration data and local storage for image data:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman run -d --rm -p 80:8080 -p 443:8443  \
   --name=quay \
   -v $QUAY/config:/conf/stack:Z \
   -v $QUAY/storage:/datastorage:Z \
   registry.redhat.io/quay/quay-rhel8:v3.11.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-quay-poc">Using Red Hat Quay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following steps show you how to use the interface and create new organizations and repositories , and to search and browse existing repositories. Following step 3, you can use the command line interface to interact with the registry, and to push and pull images.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use your browser to access the user interface for the Red Hat Quay registry at <code>http://quay-server.example.com</code>, assuming you have configured <code>quay-server.example.com</code> as your hostname in your <code>/etc/hosts</code> file.</p>
</li>
<li>
<p>Click <code>Create Account</code> and add a user, for example, <code>quayadmin</code> with a password <code>password</code>.</p>
</li>
<li>
<p>From the command line, log in to the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman login --tls-verify=false quay-server.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Username: quayadmin
Password: password
Login Succeeded!</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="pushing-pulling-images-poc">Pushing and pulling images on Red Hat Quay</h3>
<div class="paragraph">
<p>Use the following procedure to push and pull images to your Red Hat Quay registry.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To test pushing and pulling images from the Red Hat Quay registry, first pull a sample image from an external registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman pull busybox</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Trying to pull docker.io/library/busybox...
Getting image source signatures
Copying blob 4c892f00285e done
Copying config 22667f5368 done
Writing manifest to image destination
Storing signatures
22667f53682a2920948d19c7133ab1c9c3f745805c14125859d20cede07f11f9</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to see the local copy of the image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman images</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">REPOSITORY                          TAG      IMAGE ID       CREATED         SIZE
docker.io/library/busybox           latest   22667f53682a   14 hours ago    1.45 MB</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to tag this image, which prepares the image for pushing it to the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman tag docker.io/library/busybox quay-server.example.com/quayadmin/busybox:test</code></pre>
</div>
</div>
</li>
<li>
<p>Push the image to your registry. Following this step, you can use your browser to see the tagged image in your repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman push --tls-verify=false quay-server.example.com/quayadmin/busybox:test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Getting image source signatures
Copying blob 6b245f040973 done
Copying config 22667f5368 done
Writing manifest to image destination
Storing signatures</code></pre>
</div>
</div>
</li>
<li>
<p>To test access to the image from the command line, first delete the local copy of the image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman rmi quay-server.example.com/quayadmin/busybox:test
Untagged: quay-server.example.com/quayadmin/busybox:test</code></pre>
</div>
</div>
</li>
<li>
<p>Pull the image again, this time from your Red Hat Quay registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman pull --tls-verify=false quay-server.example.com/quayadmin/busybox:test</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Trying to pull quay-server.example.com/quayadmin/busybox:test...
Getting image source signatures
Copying blob 6ef22a7134ba [--------------------------------------] 0.0b / 0.0b
Copying config 22667f5368 done
Writing manifest to image destination
Storing signatures
22667f53682a2920948d19c7133ab1c9c3f745805c14125859d20cede07f11f9</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-quay-poc-deployment">Proof of concept deployment using SSL/TLS certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the following sections to configure a proof of concept Red Hat Quay deployment with SSL/TLS certificates.</p>
</div>
<div class="sect2">
<h3 id="introduction-using-ssl">Using SSL/TLS</h3>
<div class="paragraph">
<p>To configure Red Hat Quay with a self-signed certificate, you must create a Certificate Authority (CA) and a primary key file named <code>ssl.cert</code> and <code>ssl.key</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following examples assume that you have configured the server hostname <code>quay-server.example.com</code> using DNS or another naming mechanism, such as adding an entry in your <code>/etc/hosts</code> file. For more information, see "Configuring port mapping for Red Hat Quay".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="creating-a-certificate-authority">Creating a Certificate Authority</h4>
<div class="paragraph">
<p>Use the following procedure to create a Certificate Authority (CA).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate the root CA key by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openssl genrsa -out rootCA.key 2048</code></pre>
</div>
</div>
</li>
<li>
<p>Generate the root CA certificate by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the information that will be incorporated into your certificate request, including the server hostname, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Country Name (2 letter code) [XX]:IE
State or Province Name (full name) []:GALWAY
Locality Name (eg, city) [Default City]:GALWAY
Organization Name (eg, company) [Default Company Ltd]:QUAY
Organizational Unit Name (eg, section) []:DOCS
Common Name (eg, your name or your server's hostname) []:quay-server.example.com</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="signing-a-certificate">Signing the certificate</h5>
<div class="paragraph">
<p>Use the following procedure to sign the certificate.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate the server key by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openssl genrsa -out ssl.key 2048</code></pre>
</div>
</div>
</li>
<li>
<p>Generate a signing request by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openssl req -new -key ssl.key -out ssl.csr</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the information that will be incorporated into your certificate request, including the server hostname, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Country Name (2 letter code) [XX]:IE
State or Province Name (full name) []:GALWAY
Locality Name (eg, city) [Default City]:GALWAY
Organization Name (eg, company) [Default Company Ltd]:QUAY
Organizational Unit Name (eg, section) []:DOCS
Common Name (eg, your name or your server's hostname) []:quay-server.example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Create a configuration file <code>openssl.cnf</code>, specifying the server hostname, for example:</p>
<div class="listingblock">
<div class="title">openssl.cnf</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">[req]
req_extensions = v3_req
distinguished_name = req_distinguished_name
[req_distinguished_name]
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names
[alt_names]
DNS.1 = quay-server.example.com
IP.1 = 192.168.1.112</code></pre>
</div>
</div>
</li>
<li>
<p>Use the configuration file to generate the certificate <code>ssl.cert</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openssl x509 -req -in ssl.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out ssl.cert -days 356 -extensions v3_req -extfile openssl.cnf</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-ssl-tls">Configuring SSL/TLS</h3>
<div class="paragraph">
<p>SSL/TLS can be configured using either the command-line interface (CLI) or the Red Hat Quay registry UI. Use one of the following procedures to configure SSL/TLS.</p>
</div>
<div class="sect3">
<h4 id="configuring-ssl-using-ui">Configuring SSL/TLS using the Red Hat Quay UI</h4>
<div class="paragraph">
<p>Use the following procedure to configure SSL/TLS using the Red Hat Quay UI.</p>
</div>
<div class="paragraph">
<p>To configure SSL/TLS using the command line interface, see "Configuring SSL/TLS using the command line interface".</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created a certificate authority and signed a certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start the <code>Quay</code> container in configuration mode:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman run --rm -it --name quay_config -p 80:8080 -p 443:8443 registry.redhat.io/quay/quay-rhel8:v3.11.0 config secret</pre>
</div>
</div>
</li>
<li>
<p>In the <strong>Server Configuration</strong> section, select <strong>Red Hat Quay handles TLS</strong> for SSL/TLS. Upload the certificate file and private key file created earlier, ensuring that the <strong>Server Hostname</strong> matches the value used when the certificates were created.</p>
</li>
<li>
<p>Validate and download the updated configuration.</p>
</li>
<li>
<p>Stop the <code>Quay</code> container and then restart the registry by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman rm -f quay
$ sudo podman run -d --rm -p 80:8080 -p 443:8443 \
--name=quay \
-v $QUAY/config:/conf/stack:Z \
-v $QUAY/storage:/datastorage:Z \
registry.redhat.io/quay/quay-rhel8:v3.11.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ssl-using-cli">Configuring SSL/TLS using the command line interface</h4>
<div class="paragraph">
<p>Use the following procedure to configure SSL/TLS using the CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created a certificate authority and signed the certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the certificate file and primary key file to your configuration directory, ensuring they are named <code>ssl.cert</code> and <code>ssl.key</code> respectively:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">cp ~/ssl.cert ~/ssl.key $QUAY/config</code></pre>
</div>
</div>
</li>
<li>
<p>Change into the <code>$QUAY/config</code> directory by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cd $QUAY/config</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>config.yaml</code> file and specify that you want Red Hat Quay to handle TLS/SSL:</p>
<div class="listingblock">
<div class="title">config.yaml</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">...
SERVER_HOSTNAME: quay-server.example.com
...
PREFERRED_URL_SCHEME: https
...</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: Append the contents of the rootCA.pem file to the end of the ssl.cert file by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat rootCA.pem &gt;&gt; ssl.cert</code></pre>
</div>
</div>
</li>
<li>
<p>Stop the <code>Quay</code> container by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman stop quay</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the registry by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo podman run -d --rm -p 80:8080 -p 443:8443 \
  --name=quay \
  -v $QUAY/config:/conf/stack:Z \
  -v $QUAY/storage:/datastorage:Z \
  registry.redhat.io/quay/quay-rhel8:v3.11.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-ssl-tls-configuration">Testing the SSL/TLS configuration</h3>
<div class="paragraph">
<p>Your SSL/TLS configuration can be tested using either the command-line interface (CLI) or the Red Hat Quay registry UI. Use one of the following procedures to test your SSL/TLS configuration.</p>
</div>
<div class="sect3">
<h4 id="testing-ssl-tls-configuration-using-cli">Testing the SSL/TLS configuration using the CLI</h4>
<div class="paragraph">
<p>Use the following procedure to test your SSL/TLS configuration using the CLI.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the following command to attempt to log in to the Red Hat Quay registry with SSL/TLS enabled:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman login quay-server.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Error: error authenticating creds for "quay-server.example.com": error pinging docker registry quay-server.example.com: Get "https://quay-server.example.com/v2/": x509: certificate signed by unknown authority</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Because Podman does not trust self-signed certificates, you must use the <code>--tls-verify=false</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman login --tls-verify=false quay-server.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Login Succeeded!</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a subsequent section, you will configure Podman to trust the root Certificate Authority.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="testing-ssl-tls-using-browser">Testing the SSL/TLS configuration using a browser</h4>
<div class="paragraph">
<p>Use the following procedure to test your SSL/TLS configuration using a browser.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to your Red Hat Quay registry endpoint, for example, <code><a href="https://quay-server.example.com" class="bare">https://quay-server.example.com</a></code>. If configured correctly, the browser warns of the potential risk:</p>
<div class="paragraph">
<p><span class="image"><img src="../images/ssl-connection-not-private.png" alt="Potential risk"></span></p>
</div>
</li>
<li>
<p>Proceed to the log in screen. The browser notifies you that the connection is not secure. For example:</p>
<div class="paragraph">
<p><span class="image"><img src="../images/ssl-connection-not-secure.png" alt="Connection not secure"></span></p>
</div>
<div class="paragraph">
<p>In the following section, you will configure Podman to trust the root Certificate Authority.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-podman-trust-ca">Configuring Podman to trust the Certificate Authority</h3>
<div class="paragraph">
<p>Podman uses two paths to locate the Certificate Authority (CA) file: <code>/etc/containers/certs.d/</code> and <code>/etc/docker/certs.d/</code>. Use the following procedure to configure Podman to trust the CA.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the root CA file to one of <code>/etc/containers/certs.d/</code> or <code>/etc/docker/certs.d/</code>. Use the exact path determined by the server hostname, and name the file <code>ca.crt</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo cp rootCA.pem /etc/containers/certs.d/quay-server.example.com/ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that you no longer need to use the <code>--tls-verify=false</code> option when logging in to your Red Hat Quay registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo podman login quay-server.example.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Login Succeeded!</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-system-trust-ca">Configuring the system to trust the certificate authority</h3>
<div class="paragraph">
<p>Use the following procedure to configure your system to trust the certificate authority.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command to copy the <code>rootCA.pem</code> file to the consolidated system-wide trust store:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo cp rootCA.pem /etc/pki/ca-trust/source/anchors/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to update the system-wide trust store configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo update-ca-trust extract</code></pre>
</div>
</div>
</li>
<li>
<p>Optional. You can use the <code>trust list</code> command to ensure that the <code>Quay</code> server has been configured:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ trust list | grep quay
    label: quay-server.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when you browse to the registry at <code><a href="https://quay-server.example.com" class="bare">https://quay-server.example.com</a></code>, the lock icon shows that the connection is secure:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/ssl-connection-secure.png" alt="Connection not secure"></span></p>
</div>
</li>
<li>
<p>To remove the <code>rootCA.pem</code> file from system-wide trust, delete the file and update the configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo rm /etc/pki/ca-trust/source/anchors/rootCA.pem</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ sudo update-ca-trust extract</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ trust list | grep quay</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>More information can be found in the RHEL 9 documentation in the chapter <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/securing_networks/index#using-shared-system-certificates_securing-networks">Using shared system certificates</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="poc-next-steps">Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections might be useful after deploying a proof of concept version of Red Hat Quay. Many of these procedures can be used on a proof of concept deployment, offering insights to Red Hat Quay&#8217;s features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/use_red_hat_quay/index">Using Red Hat Quay</a>. The content in this guide explains the following concepts:</p>
<div class="ulist">
<ul>
<li>
<p>Adding users and repositories</p>
</li>
<li>
<p>Using image tags</p>
</li>
<li>
<p>Building Dockerfiles with build workers</p>
</li>
<li>
<p>Setting up build triggers</p>
</li>
<li>
<p>Adding notifications for repository events</p>
</li>
<li>
<p>and more</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/manage_red_hat_quay/index">Managing Red Hat Quay</a>. The content in this guide explains the following concepts:</p>
<div class="ulist">
<ul>
<li>
<p>Using SSL/TLS</p>
</li>
<li>
<p>Configuring action log storage</p>
</li>
<li>
<p>Configuring Clair security scanner</p>
</li>
<li>
<p>Repository mirroring</p>
</li>
<li>
<p>IPv6 and dual-stack deployments</p>
</li>
<li>
<p>Configuring OIDC for Red Hat Quay</p>
</li>
<li>
<p>Geo-replication</p>
</li>
<li>
<p>and more</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-05-02 12:42:45 -0400
</div>
</div>
</body>
</html>
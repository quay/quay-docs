[[config-preconfigure-automation]]
= Pre-configuring Quay for automation

Quay has a number of configuration options that support automation. These options can be set before deployment, to minimize the need to interact with the user interface.

== Allowing the API to create the first user

Set the config option `FEATURE_USER_INITIALIZE` to `true`, so that you can use the API `/api/v1/user/initialize` to create the first user. This API endpoint does not require authentication, unlike all other registry API calls which require an OAuth token which is generated by an OAuth application in an existing organization.

Once you have deployed Quay, you can use the API to create a user, for example, `quayadmin`, provided no other users have already been created. For more information, see the section on

// xref:api-first-user[Creating the first user using the API]

== Enabling general API access

Set the config option `BROWSER_API_CALLS_XHR_ONLY` to `false`, to allow general access to the Quay registry API.

== Adding a super user

While you cannot create a user until after deployment, it is convenient to ensure that first user is an administrator with full permissions. It is easier to configure this in advance, using the `SUPER_USER` configuration object.

== Restricting user creation

Once you have configured a super user, you can restrict the ability to create new users to the super user group. Set the `FEATURE_USER_CREATION`  to `false` to restrict user creation.



== Suggested configuration for automation

Create a `config.yaml` configuration file that includes the appropriate settings:

.config.yaml
[source,yaml]
----
...
FEATURE_USER_INITIALIZE: true
BROWSER_API_CALLS_XHR_ONLY: false
SUPER_USERS:
- quayadmin
FEATURE_USER_CREATION: false
...
----


== Deploying the Operator using the initial configuration

. Create a Secret using the configuration file
+
----
$ oc create secret generic --from-file config.yaml=./config.yaml init-config-bundle-secret
----
. Create a QuayRegistry YAML file `quayregistry.yaml`, identifying the unmanaged components and also referencing the created Secret, for example:
+
.quayregistry.yaml
[source,yaml]
----
apiVersion: quay.redhat.com/v1
kind: QuayRegistry
metadata:
  name: example-registry
  namespace: quay-enterprise
spec:
  configBundleSecret: init-config-bundle-secret
----
. Deploy the registry:
+
----
$ oc create -f quayregistry.yaml
----
. Create the first user, `quayadmin`, using the API

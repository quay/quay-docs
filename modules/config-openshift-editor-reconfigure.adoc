= Reconfiguring Quay on OpenShift using config tool UI

Before making a change to the Quay configuration, list the pods that are currently running:


----
$ oc get pods


----

== Updating configuration

In this example of updating the configuration, a superuser is added via the config editor tool:

. Add a super user to Quay:
+
image:config-editor-su.png[Add super user]
. Validate the new configuration and the apply the changes by pressing the Reconfigure Quay button:
+
image:config-editor-reconfigure.png[Reconfigure]

. The config tool notifies you that the change has been submitted to Quay:
+
image:config-editor-reconfigured.png[Reconfigured]



== Monitoring reconfiguration

. Use the `oc get pods` command to watch Quay reconciling. The existing pods are terminated and new pods are created using the updated configuration:
+
----
$ oc get pods -n quay-enterprise

NAME                                                   READY   STATUS              RESTARTS   AGE
example-registry-clair-app-5f896c5cb7-2t8sl            1/1     Running             0          1d
example-registry-clair-app-5f896c5cb7-826sg            1/1     Terminating         0          1d
example-registry-clair-app-666d4dd49-xblsz             0/1     ContainerCreating   0          0s
example-registry-clair-postgres-54956d6d9c-g9q2l       1/1     Terminating         0          1d
example-registry-quay-app-64b8db6fb8-8brtg             0/1     ContainerCreating   0          0s
example-registry-quay-app-6984d7fdc6-55rft             1/1     Terminating         0          1d
example-registry-quay-app-6984d7fdc6-zh77k             1/1     Running             0          1d
example-registry-quay-app-upgrade-p8fzp                0/1     ContainerCreating   0          7s
example-registry-quay-config-editor-5f79d55b74-ll6k8   1/1     Running             0          1d
example-registry-quay-config-editor-85cc6b4c48-m94tf   0/1     ContainerCreating   0          0s
example-registry-quay-database-56b9cddb47-bnksb        0/1     ContainerCreating   0          0s
example-registry-quay-database-78bf6868c9-mxlvk        1/1     Running             0          1d
example-registry-quay-mirror-84bd968858-n8jk7          1/1     Terminating         0          1d
example-registry-quay-mirror-84bd968858-tmswk          1/1     Terminating         0          1d
example-registry-quay-postgres-init-qbkn2              0/1     ContainerCreating   0          0s
example-registry-quay-redis-8bd67b647-jwpg9            1/1     Running             0          1d
----


. You can also monitor the health of the components during reconcilliation:
+
----
$ oc get quayregistry -n quay-enterprise -o yaml

apiVersion: v1
items:
- apiVersion: quay.redhat.com/v1
  kind: QuayRegistry
...
    unhealthyComponents:
      base:
      - lastTransitionTime: "2021-09-13T14:52:23Z"
        lastUpdateTime: "2021-09-13T14:52:23Z"
        message: 'Deployment example-registry-quay-app: Deployment does not have minimum availability.'
        reason: MinimumReplicasUnavailable
        status: "False"
        type: Available
      clair:
      - lastTransitionTime: "2021-09-13T14:52:23Z"
        lastUpdateTime: "2021-09-13T14:52:23Z"
        message: 'Deployment example-registry-clair-app: Deployment does not have minimum availability.'
        reason: MinimumReplicasUnavailable
        status: "False"
        type: Available
      mirror:
      - lastTransitionTime: "2021-09-13T14:52:16Z"
        lastUpdateTime: "2021-09-13T14:52:16Z"
        message: 'Deployment example-registry-quay-mirror: Deployment does not have minimum availability.'
        reason: MinimumReplicasUnavailable
        status: "False"
        type: Available
...
----



. Once Quay has reconciled the changes, the pods should show as `Running`:
+
----
$ oc get pods

NAME                                                   READY   STATUS             RESTARTS   AGE
example-registry-clair-app-666d4dd49-xblsz             0/1     Running            0          89s
example-registry-clair-app-666d4dd49-zv5ls             0/1     Running            0          82s
example-registry-clair-postgres-54956d6d9c-g9q2l       0/1     Running            0          
example-registry-quay-app-64b8db6fb8-8brtg             1/1     Running            0          89s
example-registry-quay-app-64b8db6fb8-lpfjw             1/1     Running            0          82s
example-registry-quay-app-upgrade-p8fzp                0/1     Completed          0          96s
example-registry-quay-config-editor-85cc6b4c48-m94tf   1/1     Running            0          89s
example-registry-quay-database-56b9cddb47-bnksb        1/1     Running            0          89s
example-registry-quay-mirror-6cb99dc448-gkpjr          1/1     Running            0          52s
example-registry-quay-mirror-6cb99dc448-s92tp          1/1     Running            0          52s
example-registry-quay-postgres-init-qbkn2              0/1     Completed          0          89s
example-registry-quay-redis-8bd67b647-jwpg9            1/1     Running            0          1d


== Accessing the updated secret

Since a new pod has been created for the config tool, a new secret will have been created, and you will need to use the updated password when you next attempt to login:

image:config-editor-secret-updated.png[Config editor secret updated]



== Accessing the updated config.yaml

Use the config bundle to access the updated `config.yaml` file. 

. On the QuayRegistry details screen, click on the Config Bundle Secret

. In the Data section of the Secret details screen, click Reveal values to see the `config.yaml` file

. Check that the change has been applied. In this case, `quayadmin` should be in the list of superusers: 
+
[source,yaml]
----
...
SERVER_HOSTNAME: example-quay-openshift-operators.apps.docs.quayteam.org
SETUP_COMPLETE: true
SUPER_USERS:
- quayadmin
TAG_EXPIRATION_OPTIONS:
- 2w
...
----


